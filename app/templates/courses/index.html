{% extends "base.html" %}

{% block title %}Mes Listes de Courses{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="display-5">
            <i class="bi bi-cart"></i> Mes Listes de Courses
        </h1>
        <p class="lead text-muted">{{ listes|length }} liste(s)</p>
    </div>
</div>

<!-- Filtres -->
<div class="row mb-4">
    <div class="col-md-6">
        <input type="text" class="form-control" id="searchListes" placeholder="Rechercher une liste...">
    </div>
    <div class="col-md-3">
        <select class="form-select" id="filterStatus">
            <option value="">Toutes les listes</option>
            <option value="incomplete">Non terminées</option>
            <option value="complete">Terminées</option>
        </select>
    </div>
</div>

<!-- Liste des listes de courses -->
{% if listes %}
<div class="row">
    {% for liste in listes %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">{{ liste.nom }}</h5>

                <p class="card-text text-muted">
                    <i class="bi bi-calendar3"></i> {{ liste.created_at.strftime('%d/%m/%Y') }}<br>
                    {% if liste.menu %}
                    <i class="bi bi-calendar-week"></i> <a href="{{ url_for('menus.detail', id=liste.menu.id) }}">{{ liste.menu.nom }}</a><br>
                    {% endif %}
                </p>

                {% set nb_ingredients = liste.ingredients.count() %}
                {% set nb_achetes = liste.ingredients|selectattr('achete', 'equalto', true)|list|length %}

                <div class="progress mb-2" style="height: 25px;">
                    <div class="progress-bar {% if nb_achetes == nb_ingredients %}bg-success{% endif %}"
                         role="progressbar"
                         style="width: {{ (nb_achetes / nb_ingredients * 100)|round if nb_ingredients > 0 else 0 }}%"
                         aria-valuenow="{{ nb_achetes }}"
                         aria-valuemin="0"
                         aria-valuemax="{{ nb_ingredients }}">
                        {{ nb_achetes }}/{{ nb_ingredients }}
                    </div>
                </div>

                <p class="card-text">
                    <small class="text-muted">
                        <i class="bi bi-basket"></i> {{ nb_ingredients }} article(s)
                    </small>
                </p>
            </div>

            <div class="card-footer bg-white">
                <a href="{{ url_for('courses.detail', id=liste.id) }}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-eye"></i> Voir
                </a>
                <a href="{{ url_for('courses.export_pdf', id=liste.id) }}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-file-pdf"></i> PDF
                </a>
                <form method="POST" action="{{ url_for('courses.delete', id=liste.id) }}" class="d-inline" onsubmit="return confirmDelete('Êtes-vous sûr de vouloir supprimer cette liste ?');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info">
    <i class="bi bi-info-circle"></i> Vous n'avez pas encore créé de liste de courses.
    <a href="{{ url_for('menus.index') }}" class="alert-link">Créer un menu pour générer une liste</a>
</div>
{% endif %}
{% endblock %}
